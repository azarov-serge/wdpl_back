## Шаг 4: Публикованные события и публикация черновиков

### Цель шага

- Описать отдельный домен **публикованных событий** (`events`, `event_days`).
- Формализовать операцию **публикации** как переход из домена черновиков (`event_drafts`, `event_day_drafts`) в публичный домен.
- Подготовить контракты для Go‑бэкенда (фича `events`) и фронтенда.

### Домен публикованных событий

- **Таблица `events`**:
  - хранит только "публичные" версии событий;
  - не содержит "черновых" изменений;
  - данные здесь всегда готовы к показу пользователям.
- **Таблица `event_days`**:
  - хранит опубликованные расписания по дням (см. подробную JSONB‑структуру в `docs/SUPABASE.md`);
  - используется фронтендом/мобильными клиентами для отображения программы.

Ключевые свойства домена:

- Данные должны быть **валидными и консистентными** — сюда попадает только то, что прошло стадию черновика и валидации.
- Пользовательский фронтенд читает данные только из этого домена (а не из черновиков).

### Операция публикации

Публикация — это **явный переход** из "чернового" домена в публичный:

- Источник: `event_drafts` / `event_day_drafts`.
- Приёмник: `events` / `event_days`.
- Шаги (упрощённо):
  1. Прочитать черновик по идентификатору (`draft_id` или `event_id`).
  2. Сконструировать / обновить запись в `events` и/или `event_days`.
  3. Сохранить изменения (upsert).
  4. При необходимости удалить или пометить черновик как опубликованный.

### Связь с Supabase схемой

В `docs/SUPABASE.md` уже описаны:

- структуры `Event`, `EventDraft`, `EventDay`, `EventDayDraft`,
- SQL‑таблицы для публичных данных и черновиков,
- функции/триггеры для:
  - обновления `updated_at`,
  - валидации,
  - агрегации метаданных по дням.

На Go‑бэкенде мы повторяем те же идеи:

- отдельные доменные модели `Event` / `EventDraft`,
- отдельные репозитории и сервисы для публикации (см. `internal/features/events`),
- чёткое разграничение ответственности:
  - **черновики** — шаг 3;
  - **публикованные события + публикация** — шаг 4.

### API‑наметки для Go‑бэкенда

Работа с черновиками (из шага 3) и публикацией (этот шаг) может выглядеть так:

- **Черновики (организаторы/админы)**:
  - `GET /api/events/drafts` — список черновиков.
  - `GET /api/events/:id/draft` — получение черновика по событию.
  - `PUT /api/events/:id/draft` — сохранение изменений черновика.
- **Публикация**:
  - `POST /api/events/:id/publish` — публикация черновика в `events` (и, при необходимости, в `event_days`).
- **Публичные события (все пользователи)**:
  - `GET /api/events` — список опубликованных событий (с фильтрами, пагинацией).
  - `GET /api/events/:id` — детальная информация о событии, включая опубликованные дни.

Конкретика по полям и фильтрам берётся из `docs/SUPABASE.md` и адаптируется под Go‑структуры и HTTP‑контракты.

